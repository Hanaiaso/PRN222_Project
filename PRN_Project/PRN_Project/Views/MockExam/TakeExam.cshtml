@model PRN_Project.Models.Exam

@{
    var duration = (Model.EndTime - DateTime.Now)?.TotalSeconds ?? 0;
}

<h2>📝 Bài thi: @Model.EName</h2>

<div class="alert alert-info">
    <strong>Thời gian còn lại: </strong> <span id="timer"></span>
</div>

<form id="examForm" method="post" asp-action="SubmitExam" asp-controller="MockExam">
    <input type="hidden" name="examId" value="@Model.EId" />

    @for (int i = 0; i < Model.Questions!.Count; i++)
    {
        var q = Model.Questions[i];
        <div class="card mb-3 p-3">
            <h5>Câu @(@i + 1): @q.Question</h5>
            @foreach (var opt in q.Options)
            {
                <div>
                    <input type="radio" name="answers[@i].ChosenAnswer" value="@opt" />
                    <label>@opt</label>
                </div>
            }
            <input type="hidden" name="answers[@i].QuestionIndex" value="@i" />
        </div>
    }

    <button type="submit" class="btn btn-primary">Nộp bài</button>
</form>

<script>
    let timeLeft = @duration;
    const timerDisplay = document.getElementById("timer");

    function updateTimer() {
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        timerDisplay.innerText = `${minutes} phút ${seconds} giây`;
        timeLeft--;

        if (timeLeft <= 0) {
            document.getElementById("examForm").submit();
        } else {
            setTimeout(updateTimer, 1000);
        }
    }
    updateTimer();
</script>
